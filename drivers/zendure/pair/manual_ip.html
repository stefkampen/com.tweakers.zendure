<style>
  .wrap { display: flex; flex-direction: column; gap: 12px; }
  .row { display: flex; gap: 8px; align-items: center; }
  input[type="text"] { flex: 1; padding: 8px; font-size: 14px; }
  button { padding: 8px 12px; font-size: 14px; }
  .hint { color: #666; font-size: 12px; }
  .error { color: #b00020; font-size: 12px; }
  .success { color: #0b8; font-size: 12px; }
  .actions { display: flex; gap: 8px; }
</style>

<div class="wrap">
  <div class="row">
    <input id="ip" type="text" placeholder="192.168.1.123" />
    <button id="submit">Continue</button>
  </div>
  <div class="actions">
    <button id="skip">Skip</button>
  </div>
  <div class="hint">Enter the device IP if mDNS discovery does not find it. You can skip this step.</div>
  <div id="message"></div>
</div>

<script>
  (function() {
    const ipInput = document.getElementById('ip');
    const submitBtn = document.getElementById('submit');
    const skipBtn = document.getElementById('skip');
    const msg = document.getElementById('message');

    function showMessage(text, cls) {
      msg.className = cls || '';
      msg.textContent = text || '';
    }

    submitBtn.addEventListener('click', async () => {
      const ip = (ipInput.value || '').trim();
      if (!/^\d{1,3}(?:\.\d{1,3}){3}$/.test(ip)) {
        showMessage('Please enter a valid IPv4 address', 'error');
        return;
      }
      showMessage('Checking device...', '');
      try {
        const result = await Homey.emit('manual_ip_submit', { ip });
        if (result && result.ok) {
          showMessage('Device found or added to list. Proceeding...', 'success');
        } else {
          showMessage(result && result.message ? result.message : 'Failed to verify device. It may still be added to the list.', 'error');
        }
      } catch (e) {
        showMessage('Unexpected error while submitting IP', 'error');
      }
    });

    skipBtn.addEventListener('click', async () => {
      try {
        await Homey.emit('manual_ip_skip', {});
      } catch (e) {
        // ignore
      }
    });
  })();
</script>


